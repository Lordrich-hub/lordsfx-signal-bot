<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Forex Signal Bot</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background-color: #111; color: white; }
    .card { background-color: #1e1e1e; }
  </style>
</head>
<body>
  <div class="container py-5">
    <h1 class="text-center">üìà LordsFx Signal Provider</h1>
    <div class="text-center my-4">
      <label for="pairSelector" class="form-label">Choose a Forex Pair:</label>
      <select id="pairSelector" class="form-select w-50 mx-auto mb-3">
        <option value="EUR/USD">EUR/USD</option>
        <option value="GBP/USD">GBP/USD</option>
        <option value="USD/JPY">USD/JPY</option>
        <option value="GBP/JPY">GBP/JPY</option>
        <option value="USD/CHF">USD/CHF</option>
        <option value="GBP/CHF">GBP/CHF</option>
        <option value="AUD/USD">AUD/USD</option>
        <option value="CHF/JPY">CHF/JPY</option>
      </select>
      <button class="btn btn-primary" onclick="checkSignal()">Check Market Signal</button>
    </div>

    <div id="signalBox" class="text-center"></div>

    <div id="lotSizeCalculator" class="text-center mt-4" style="display:none;">
      <h5>üìè Lot Size Calculator</h5>
      <div class="mb-2">
        <input type="number" id="accountSize" class="form-control w-50 mx-auto" placeholder="Account Size ($)">
      </div>
      <div class="mb-2">
        <input type="number" id="riskPercent" class="form-control w-50 mx-auto" placeholder="Risk % per Trade">
      </div>
      <button class="btn btn-success" onclick="calculateLotSize()">Calculate Lot Size</button>
      <p id="lotSizeResult" class="mt-3 fw-bold"></p>
    </div>
  </div>

  <script>
    let signalEntry = 0;
    let signalSL = 0;
    let selectedSymbol = "";

    async function checkSignal() {
      const selectedPair = document.getElementById("pairSelector").value;
      selectedSymbol = selectedPair;
      const url = `https://api.twelvedata.com/time_series?symbol=${selectedPair}&interval=15min&outputsize=60&apikey=3d9c9f67fe414e5cb949cda6af723aef`;

      try {
        const res = await fetch(url);
        const data = await res.json();
        if (!data.values) throw new Error(data.message || "Invalid data or API limit");

        const prices = data.values.map(d => parseFloat(d.close)).reverse();
        const ema14 = EMA(prices, 14);
        const ema50 = EMA(prices, 50);
        const rsi = RSI(prices, 14);

        const latestEMA14 = ema14[ema14.length - 1];
        const latestEMA50 = ema50[ema50.length - 1];
        const latestRSI = rsi[rsi.length - 1];
        const entry = parseFloat(data.values[0].close);

        let signalText = "‚ùå No Signal";
        document.getElementById("lotSizeCalculator").style.display = 'none';

        if (latestEMA14 > latestEMA50 && latestRSI > 50) {
          const sl = entry - (entry * 0.01);
          const tp1 = entry + (entry * 0.01);
          const tp2 = entry + (entry * 0.014);

          signalEntry = entry;
          signalSL = sl;

          signalText = `
            <div class='card text-white p-4'>
              <h3>‚ôæ ${selectedPair} BUY SIGNAL</h3>
              <p>üìç Entry: ${entry.toFixed(3)}</p>
              <p>üî¥ SL: ${sl.toFixed(3)}</p>
              <p>üí∞ TP1: ${tp1.toFixed(3)}</p>
              <p>üí∞ TP2: ${tp2.toFixed(3)}</p>
              <p>üöÄ LordsFx Signal | ‚è≥ Expires in 2 Hours | M15 Chart</p>
            </div>`;
          document.getElementById("lotSizeCalculator").style.display = 'block';
        } else if (latestEMA14 < latestEMA50 && latestRSI < 50) {
          const sl = entry + (entry * 0.01);
          const tp1 = entry - (entry * 0.01);
          const tp2 = entry - (entry * 0.014);

          signalEntry = entry;
          signalSL = sl;

          signalText = `
            <div class='card text-white p-4'>
              <h3>‚ôæ ${selectedPair} SELL SIGNAL</h3>
              <p>üìç Entry: ${entry.toFixed(3)}</p>
              <p>üî¥ SL: ${sl.toFixed(3)}</p>
              <p>üí∞ TP1: ${tp1.toFixed(3)}</p>
              <p>üí∞ TP2: ${tp2.toFixed(3)}</p>
              <p>üöÄ LordsFx Signal | ‚è≥ Expires in 2 Hours | M15 Chart</p>
            </div>`;
          document.getElementById("lotSizeCalculator").style.display = 'block';
        }

        document.getElementById("signalBox").innerHTML = signalText;
      } catch (err) {
        document.getElementById("signalBox").innerHTML = `<div class='alert alert-danger'>Error loading signal: ${err.message}</div>`;
      }
    }

    function calculateLotSize() {
      const accSize = parseFloat(document.getElementById("accountSize").value);
      const riskPct = parseFloat(document.getElementById("riskPercent").value);

      if (!accSize || !riskPct || signalEntry === 0 || signalSL === 0) {
        document.getElementById("lotSizeResult").innerText = "‚ùó Please fill in all fields or check signal first.";
        return;
      }

      const pair = selectedSymbol.toUpperCase();
      const isJPY = pair.includes("JPY");
      const pipSize = isJPY ? 0.01 : 0.0001;
      const pipDistance = Math.abs(signalEntry - signalSL);
      const slPips = pipDistance / pipSize;

      const riskAmount = (accSize * riskPct) / 100;
      const pipValuePerLot = 10;
      const lotSize = riskAmount / (slPips * pipValuePerLot);

      const resultText = `‚úÖ <span class="text-success">Use Lot Size: ${lotSize.toFixed(2)}</span><br>
        üìè SL Distance: ${slPips.toFixed(1)} pips`;

      document.getElementById("lotSizeResult").innerHTML = resultText;
    }

    function EMA(prices, length) {
      const k = 2 / (length + 1);
      const emaArray = [prices[0]];
      for (let i = 1; i < prices.length; i++) {
        emaArray.push(prices[i] * k + emaArray[i - 1] * (1 - k));
      }
      return emaArray;
    }

    function RSI(closes, period = 14) {
      const gains = [], losses = [];
      for (let i = 1; i <= period; i++) {
        const diff = closes[i] - closes[i - 1];
        if (diff >= 0) gains.push(diff);
        else losses.push(Math.abs(diff));
      }
      let avgGain = gains.reduce((a, b) => a + b, 0) / period;
      let avgLoss = losses.reduce((a, b) => a + b, 0) / period;
      const rs = avgGain / avgLoss;
      const rsiArray = [100 - 100 / (1 + rs)];
      for (let i = period + 1; i < closes.length; i++) {
        const change = closes[i] - closes[i - 1];
        const gain = change > 0 ? change : 0;
        const loss = change < 0 ? Math.abs(change) : 0;
        avgGain = (avgGain * (period - 1) + gain) / period;
        avgLoss = (avgLoss * (period - 1) + loss) / period;
        const newRS = avgGain / avgLoss;
        rsiArray.push(100 - 100 / (1 + newRS));
      }
      return rsiArray;
    }
  </script>

  <!-- üîí Disable inspect tools -->
  <script>
    document.addEventListener('contextmenu', event => event.preventDefault());
    document.onkeydown = function (e) {
      if (
        e.key === 'F12' ||
        (e.ctrlKey && e.shiftKey && (e.key === 'I' || e.key === 'J' || e.key === 'C')) ||
        (e.ctrlKey && e.key === 'U')
      ) return false;
    };
  </script>
</body>
</html>
