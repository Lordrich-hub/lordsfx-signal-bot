<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Forex Signal Bot</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background-color: #111; color: white; }
    .card { background-color: #1e1e1e; }
  </style>
</head>
<body>
  <div class="container py-5">
    <h1 class="text-center">üìà LordsFx Signal Provider</h1>
    <div class="text-center my-4">
      <label for="pairSelector" class="form-label">Choose a Forex Pair:</label>
      <select id="pairSelector" class="form-select w-50 mx-auto mb-3">
        <option value="EUR/USD">EUR/USD</option>
        <option value="GBP/USD">GBP/USD</option>
        <option value="USD/JPY">USD/JPY</option>
        <option value="GBP/JPY">GBP/JPY</option>
        <option value="USD/CHF">USD/CHF</option>
        <option value="GBP/CHF">GBP/CHF</option>
        <option value="AUD/USD">AUD/USD</option>
        <option value="CHF/JPY">CHF/JPY</option>
      </select>
      <button class="btn btn-primary" onclick="checkSignal()">Check Market Signal</button>
    </div>
    <div id="signalBox" class="text-center"></div>
  </div>

  <script>
    function SMA(values, length) {
      if (values.length < length) return null;
      return values.slice(-length).reduce((a, b) => a + b, 0) / length;
    }

    function EMA(values, length) {
      const k = 2 / (length + 1);
      let ema = values[0];
      const result = [ema];
      for (let i = 1; i < values.length; i++) {
        ema = values[i] * k + ema * (1 - k);
        result.push(ema);
      }
      return result;
    }

    function RSI(values, period = 14) {
      let gains = 0, losses = 0;
      for (let i = 1; i <= period; i++) {
        const change = values[i] - values[i - 1];
        if (change > 0) gains += change;
        else losses -= change;
      }
      let avgGain = gains / period;
      let avgLoss = losses / period;
      const rsi = [];
      rsi.push(100 - (100 / (1 + avgGain / avgLoss)));
      for (let i = period + 1; i < values.length; i++) {
        const change = values[i] - values[i - 1];
        const gain = change > 0 ? change : 0;
        const loss = change < 0 ? -change : 0;
        avgGain = (avgGain * (period - 1) + gain) / period;
        avgLoss = (avgLoss * (period - 1) + loss) / period;
        const rs = avgGain / avgLoss;
        rsi.push(100 - (100 / (1 + rs)));
      }
      return rsi;
    }

    function MACD(values, fast = 12, slow = 26, signal = 9) {
      const emaFast = EMA(values, fast);
      const emaSlow = EMA(values, slow);
      const macdLine = emaFast.map((val, i) => val - emaSlow[i]);
      const signalLine = EMA(macdLine, signal);
      const histogram = macdLine.map((val, i) => val - signalLine[i]);
      return { macdLine, signalLine, histogram };
    }

    function Stochastic(highs, lows, closes, kPeriod = 9, dPeriod = 3) {
      const stochK = [];
      for (let i = 0; i <= closes.length - kPeriod; i++) {
        const high = Math.max(...highs.slice(i, i + kPeriod));
        const low = Math.min(...lows.slice(i, i + kPeriod));
        const close = closes[i + kPeriod - 1];
        stochK.push(((close - low) / (high - low)) * 100);
      }
      const stochD = EMA(stochK, dPeriod);
      return { stochK, stochD };
    }

    function CCI(closes, highs, lows, period = 14) {
      const tp = closes.map((c, i) => (c + highs[i] + lows[i]) / 3);
      const sma = SMA(tp, period);
      const md = tp.slice(-period).reduce((sum, val) => sum + Math.abs(val - sma), 0) / period;
      return ((tp[tp.length - 1] - sma) / (0.015 * md));
    }

    function WilliamsR(closes, highs, lows, period = 14) {
      const high = Math.max(...highs.slice(-period));
      const low = Math.min(...lows.slice(-period));
      const close = closes[closes.length - 1];
      return ((high - close) / (high - low)) * -100;
    }

    function ATR(highs, lows, closes, period = 14) {
      const trs = [];
      for (let i = 1; i < highs.length; i++) {
        const high = highs[i];
        const low = lows[i];
        const prevClose = closes[i - 1];
        trs.push(Math.max(high - low, Math.abs(high - prevClose), Math.abs(low - prevClose)));
      }
      return SMA(trs, period);
    }

    function ADX(highs, lows, closes, period = 14) {
      return 25; // Mock value for simplicity
    }

    function ROC(closes, period = 14) {
      return ((closes[closes.length - 1] - closes[closes.length - 1 - period]) / closes[closes.length - 1 - period]) * 100;
    }

    async function checkSignal() {
      const selectedPair = document.getElementById("pairSelector").value;
      const url = `https://api.twelvedata.com/time_series?symbol=${selectedPair}&interval=15min&outputsize=100&apikey=3d9c9f67fe414e5cb949cda6af723aef`;

      try {
        const res = await fetch(url);
        const data = await res.json();
        const closes = data.values.map(x => parseFloat(x.close)).reverse();
        const highs = data.values.map(x => parseFloat(x.high)).reverse();
        const lows = data.values.map(x => parseFloat(x.low)).reverse();

        const latestPrice = closes[closes.length - 1];
        let buys = 0, sells = 0;

        if (RSI(closes).slice(-1)[0] > 50) buys++; else sells++;
        if (MACD(closes).histogram.slice(-1)[0] > 0) buys++; else sells++;
        if (Stochastic(highs, lows, closes).stochK.slice(-1)[0] > 50) buys++; else sells++;
        if (CCI(closes, highs, lows) > 0) buys++; else sells++;
        if (WilliamsR(closes, highs, lows) > -50) buys++; else sells++;
        if (ROC(closes) > 0) buys++; else sells++;
        if (ATR(highs, lows, closes) > 0.001) buys++; else sells++;
        if (ADX(highs, lows, closes) > 20) buys++; else sells++;

        const signal = buys > sells ? 'BUY' : sells > buys ? 'SELL' : 'NONE';
        let signalHTML = "<div class='card text-white p-4'>";
        signalHTML += `<h3>‚ôæ ${selectedPair} ${signal === 'BUY' ? 'BUY' : signal === 'SELL' ? 'SELL' : 'NO'} SIGNAL</h3>`;

        if (signal === 'BUY') {
          signalHTML += `<p>üìç Entry: ${latestPrice.toFixed(3)}</p>
            <p>üî¥ SL: ${(latestPrice * 0.99).toFixed(3)}</p>
            <p>üí∞ TP1: ${(latestPrice * 1.01).toFixed(3)}</p>
            <p>üí∞ TP2: ${(latestPrice * 1.014).toFixed(3)}</p>`;
        } else if (signal === 'SELL') {
          signalHTML += `<p>üìç Entry: ${latestPrice.toFixed(3)}</p>
            <p>üî¥ SL: ${(latestPrice * 1.01).toFixed(3)}</p>
            <p>üí∞ TP1: ${(latestPrice * 0.99).toFixed(3)}</p>
            <p>üí∞ TP2: ${(latestPrice * 0.986).toFixed(3)}</p>`;
        } else {
          signalHTML += `<p>No trade opportunity right now.</p>`;
        }

        signalHTML += `<p>üìä LordsFx Signal | ‚è≥ Expires in 2 Hours | M15 Chart</p></div>`;
        document.getElementById("signalBox").innerHTML = signalHTML;
      } catch (err) {
        document.getElementById("signalBox").innerHTML = `<div class='alert alert-danger'>Error loading signal: ${err.message}</div>`;
      }
    }
  </script>
</body>
</html>
